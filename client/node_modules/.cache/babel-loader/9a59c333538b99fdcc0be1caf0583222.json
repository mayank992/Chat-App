{"ast":null,"code":"var _jsxFileName = \"/Users/mayank/Desktop/assignments/Chat-App/src/components/chat/ChatFeed.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useContext, useImperativeHandle, useLayoutEffect, useEffect } from \"react\";\nimport { FullPageSpinner } from \"../common/spinner\";\nimport { Message } from \"./Message\";\nimport { getMessages } from \"../../helpers\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { UserContext } from \"../../contexts/UserContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ChatFeed = /*#__PURE__*/_s( /*#__PURE__*/React.forwardRef(_c = _s((_ref, ref) => {\n  _s();\n\n  let {\n    chatType,\n    id\n  } = _ref;\n  const [user] = useContext(UserContext);\n  const chatFeedRef = useRef(null);\n  const initialMessageRender = useRef(true);\n  const {\n    data: messages,\n    refreshData,\n    isLoading\n  } = useQuery([chatType, id], _ref2 => {\n    let {\n      signal\n    } = _ref2;\n    return getMessages(user.id, chatType, id, {\n      signal\n    });\n  }, {\n    refetchInterval: 5000\n  });\n  useEffect(() => {\n    initialMessageRender.current = true;\n  }, [chatType, id]);\n  useLayoutEffect(() => {\n    if (chatFeedRef.current && messages) {\n      let {\n        scrollTop,\n        clientHeight,\n        scrollHeight\n      } = chatFeedRef.current;\n\n      if (initialMessageRender.current) {\n        chatFeedRef.current.scrollTop = scrollHeight;\n        initialMessageRender.current = false;\n      } else if (scrollTop + clientHeight === scrollHeight) {\n        console.log(\"second\");\n        chatFeedRef.current.scrollTop = scrollHeight;\n      }\n    }\n  }, [messages]);\n  useImperativeHandle(ref, () => ({\n    refreshFeed: refreshData\n  }));\n\n  function handleScroll(e) {\n    const {\n      scrollTop,\n      clientHeight,\n      scrollHeight\n    } = e.currentTarget;\n\n    if (scrollTop === 0) {// load more\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat__feed\",\n    ref: chatFeedRef,\n    onScroll: handleScroll,\n    children: isLoading ? /*#__PURE__*/_jsxDEV(FullPageSpinner, {\n      size: \"medium\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }, this) : messages === null || messages === void 0 ? void 0 : messages.map(message => {\n      return /*#__PURE__*/_jsxDEV(Message, {\n        message: message\n      }, message.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 20\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 7\n  }, this);\n}, \"GuxpIECswdl099VpfKGzk4mxyKk=\", false, function () {\n  return [useQuery];\n})), \"GuxpIECswdl099VpfKGzk4mxyKk=\", false, function () {\n  return [useQuery];\n});\n_c2 = ChatFeed;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ChatFeed$React.forwardRef\");\n$RefreshReg$(_c2, \"ChatFeed\");","map":{"version":3,"sources":["/Users/mayank/Desktop/assignments/Chat-App/src/components/chat/ChatFeed.tsx"],"names":["React","useRef","useContext","useImperativeHandle","useLayoutEffect","useEffect","FullPageSpinner","Message","getMessages","useQuery","UserContext","ChatFeed","forwardRef","ref","chatType","id","user","chatFeedRef","initialMessageRender","data","messages","refreshData","isLoading","signal","refetchInterval","current","scrollTop","clientHeight","scrollHeight","console","log","refreshFeed","handleScroll","e","currentTarget","map","message"],"mappings":"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","sourcesContent":["import React, {\n  useRef,\n  useContext,\n  useImperativeHandle,\n  useLayoutEffect,\n  useEffect,\n} from \"react\";\nimport { FullPageSpinner } from \"../common/spinner\";\nimport { Message } from \"./Message\";\nimport { MessageType } from \"../../types\";\nimport { getMessages } from \"../../helpers\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { UserContext } from \"../../contexts/UserContext\";\nimport { CHAT_TYPE } from \"../../constants\";\n\ntype ChatFeedProps = {\n  chatType: CHAT_TYPE;\n  id: string;\n};\n\nexport const ChatFeed = React.forwardRef(\n  ({ chatType, id }: ChatFeedProps, ref) => {\n    const [user] = useContext(UserContext);\n    const chatFeedRef = useRef<HTMLDivElement>(null);\n    const initialMessageRender = useRef<boolean>(true);\n    const {\n      data: messages,\n      refreshData,\n      isLoading,\n    } = useQuery<MessageType[]>(\n      [chatType, id],\n      ({ signal }) => getMessages(user.id, chatType, id, { signal }),\n      { refetchInterval: 5000 }\n    );\n\n    useEffect(() => {\n      initialMessageRender.current = true;\n    }, [chatType, id]);\n\n    useLayoutEffect(() => {\n      if (chatFeedRef.current && messages) {\n        let { scrollTop, clientHeight, scrollHeight } = chatFeedRef.current;\n\n        if (initialMessageRender.current) {\n          chatFeedRef.current.scrollTop = scrollHeight;\n          initialMessageRender.current = false;\n        } else if (scrollTop + clientHeight === scrollHeight) {\n          console.log(\"second\");\n          chatFeedRef.current.scrollTop = scrollHeight;\n        }\n      }\n    }, [messages]);\n\n    useImperativeHandle(ref, () => ({\n      refreshFeed: refreshData,\n    }));\n\n    function handleScroll(e: React.UIEvent<HTMLDivElement>) {\n      const { scrollTop, clientHeight, scrollHeight } = e.currentTarget;\n\n      if (scrollTop === 0) {\n        // load more\n      }\n    }\n\n    return (\n      <div className=\"chat__feed\" ref={chatFeedRef} onScroll={handleScroll}>\n        {isLoading ? (\n          <FullPageSpinner size=\"medium\" />\n        ) : (\n          messages?.map((message) => {\n            return <Message key={message.id} message={message} />;\n          })\n        )}\n      </div>\n    );\n  }\n);\n"]},"metadata":{},"sourceType":"module"}